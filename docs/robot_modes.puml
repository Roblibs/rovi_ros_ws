@startuml
title robot_mode flow (backend selection + stable contract)
left to right direction

skinparam shadowing false
skinparam DefaultTextAlignment center
skinparam ArrowColor #444444
skinparam ArrowThickness 1.2
skinparam PackageStyle rectangle
skinparam RectangleRoundCorner 12

skinparam rectangle {
  BorderColor #444444
  BackgroundColor #FFFFFF
}

skinparam package {
  BackgroundColor #F8F8F8
  BorderColor #666666
}

rectangle "rovi_bringup/rovi.launch.py\n(stack + rviz)" as Rovi
rectangle "rovi_bringup/robot_bringup.launch.py\n(robot_mode backend selector)" as RobotBringup

package "robot_mode backends" as Backends {
  rectangle "real\nrosmaster_driver + rplidar_ros" as Real #E8F5E9
  rectangle "sim\nGazebo Sim + ros_gz_bridge\nrovi_sim_base + rovi_gz_odom" as Sim #E3F2FD
  rectangle "offline\nURDF inspection only" as Offline #FFF8E1
}

package "Robot interface contract (stable)" as Contract {
  queue "/cmd_vel\n(Twist)" as CMD
  queue "Robot feedback\n/scan (LaserScan)\n/imu/data_raw (Imu)\n/vel_raw (Twist)\n/odom_raw (Odometry)\n/clock (sim only)" as Feedback
}

package "Mode-agnostic stacks (unchanged)" as Stacks {
  rectangle "rovi_localization\n(EKF)" as EKF
  rectangle "rovi_slam\n(slam_toolbox)" as SLAM
  rectangle "rovi_nav\n(Nav2)" as NAV
  rectangle "rviz2" as RVIZ
}

Rovi ..> RobotBringup : include + args

RobotBringup ..> Real : robot_mode=real
RobotBringup ..> Sim : robot_mode=sim
RobotBringup ..> Offline : robot_mode=offline

CMD --> Real
CMD --> Sim

Real --> Feedback
Sim --> Feedback

Feedback --> EKF
Feedback --> SLAM
Feedback --> NAV
Feedback --> RVIZ

Offline --> RVIZ : /robot_description + /tf
@enduml
